<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>matrix.js</title>
  <link rel="stylesheet" href="../../pycco.css">
  <script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div class='section'>
    <div class='docs'><h1>matrix.js</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="cm">/*</span>
<span class="cm">This file is part of the jsphys web physics package.  </span>
<span class="cm">Copyright (C) 2012 Matthew Watson</span>
<span class="cm">//DIVIDER</span>
<span class="cm">@fileoverview 3d and 4d linear algebra library.</span>

<span class="cm">Use with care, there are no checks on anything because it needs to be fast.</span>
<span class="cm">Empirical testing  as of early 2012 showed objects to be faster than arrays for</span>
<span class="cm">some purposes, although I suspect this may change when firefox finish their</span>
<span class="cm">compiler overhaul.  </span>
<span class="cm">This is also partially a self-control measure as it discourages</span>
<span class="cm">frequent direct component access where a more abstract operation would be </span>
<span class="cm">preferable.</span>
<span class="cm">*/</span>
<span class="cm">/*</span>
<span class="cm">  $$A\wedge B\wedge C = (A\wedge B)\wedge C$$</span>

<span class="cm">  $$=\left&lt; AB \right&gt; _2\wedge C$$</span>

<span class="cm">  $$=\left&lt;(A_te_t + A_xe_x + A_ye_y + A_ze_z)</span>
<span class="cm">     (B_te_t + B_xe_x + B_ye_y + B_ze_z)\right&gt;_2\wedge C$$</span>
<span class="cm">  $$= (A_tB_xe_te_x + A_tB_ye_te_y + A_tB_ze_te_z +\\\\ </span>
<span class="cm">       A_xB_te_xe_t + A_xB_ye_xe_y + A_xB_ze_xe_z +\\\\</span>
<span class="cm">       A_yB_te_ye_t + A_yB_xe_ye_x + A_yB_ze_ye_z +\\\\</span>
<span class="cm">       A_zB_te_ze_t + A_zB_xe_ze_x + A_zB_ye_ze_y)\wedge C$$</span>

<span class="cm">       (A_tB_x - A_xB_t)e_te_x + </span>
<span class="cm">*/</span>
<span class="cm">/*</span>
<span class="cm">  These functions were Intended for numbers but many work with string elements</span>
<span class="cm">  Most funcitons return the destination variable as well as requiring you to</span>
<span class="cm">  provide one (to avoid unnecessary if statements).</span>
<span class="cm">  As such they can either be used in a more imperative style</span>

<span class="cm">    var A = vec3.create(1,2,3),</span>
<span class="cm">        B = vec3.create(1,2,3),</span>
<span class="cm">        C = {};</span>
<span class="cm">    vec3.add(A, B, C);</span>
<span class="cm">  Or in a more functional style</span>

<span class="cm">    var A = vec3.create(1,2,3),</span>
<span class="cm">        B = vec3.create(1,2,3),</span>
<span class="cm">        C = vec3.add(A, B, {});</span>
<span class="cm">  Using in a functional style every time</span>

<span class="cm">    C = vec3.add(A, B, C);</span>
<span class="cm">  Is fine, but a bit redundant due to the requirement of providing a </span>
<span class="cm">  destination.</span>
<span class="cm">*/</span>

<span class="cm">/*</span>
<span class="cm">##vec3</span>
<span class="cm">  Functions for 3 element vectors consisting of an object with members x, y, z</span>
<span class="cm">  as in:</span>

<span class="cm">    X = {x: 1, y: 2, z: 3};</span>
<span class="cm">  Allowed to contain other elements such as being a vec4.</span>
<span class="cm">*/</span>
<span class="kd">var</span> <span class="nx">vec3</span> <span class="o">=</span> <span class="p">{</span>
  <span class="cm">/*</span>
<span class="cm">  ###vec3.create</span>
<span class="cm">    Usage:</span>

<span class="cm">      var X = vec3.create(1,2,3);</span>
<span class="cm">    Somewhat redundant as it&#39;s equivalent to:</span>

<span class="cm">      var X = vec3.setScalar(1,2,3,{});</span>
<span class="cm">  */</span>
  <span class="nx">create</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span><span class="nx">x</span><span class="o">:</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="o">:</span> <span class="nx">z</span><span class="p">};</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###vec3.setVec</span>
<span class="cm">    Usage:</span>

<span class="cm">      B = vec3.setVec(A,B);</span>
<span class="cm">      vec3.setVec(A,B);</span>
<span class="cm">      var B = vec3.setVec(A,{});</span>
<span class="cm">    Set one vector from another. Or create one using an object literal</span>
<span class="cm">    as the destination.</span>
<span class="cm">  */</span>
  <span class="nx">setVec</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">vec</span><span class="p">,</span> <span class="nx">dest</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###vec3.setArr</span>
<span class="cm">    Set a vector from an array. Can also be used for creation.</span>

<span class="cm">      var A = vec3.setArr([1,2,3],{});</span>
<span class="cm">  */</span>
  <span class="nx">setArr</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">dest</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###vec3.set</span>
<span class="cm">    Set vector from components.</span>

<span class="cm">      vec3.set(x,y,z, A);</span>
<span class="cm">      var A = vec3.set(x,y,z, {});</span>
<span class="cm">  */</span>
  <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">,</span> <span class="nx">dest</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="nx">z</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###vec3.add</span>
<span class="cm">    Add two vectors.</span>
<span class="cm">    $$\mathbf{C} = \mathbf{A} + \mathbf{B}$$</span>

<span class="cm">      vec3.add(A, B, C);</span>
<span class="cm">      var C = vec3.add(A, B, {});</span>
<span class="cm">  */</span>
  <span class="nx">add</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">vec1</span><span class="p">,</span> <span class="nx">vec2</span><span class="p">,</span> <span class="nx">dest</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">vec1</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">vec1</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="nx">vec1</span><span class="p">.</span><span class="nx">z</span> <span class="o">+</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###vec3.subtract</span>
<span class="cm">    subtract two vectors.</span>
<span class="cm">    $$\mathbf{c} = \mathbf{a} - \mathbf{b}$$</span>

<span class="cm">      vec3.subtract(a, b, c);</span>
<span class="cm">      var c = vec3.subtract(a, b, {});</span>
<span class="cm">  */</span>
  <span class="nx">subtract</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">vec1</span><span class="p">,</span> <span class="nx">vec2</span><span class="p">,</span> <span class="nx">dest</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">vec1</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">vec1</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="nx">vec1</span><span class="p">.</span><span class="nx">z</span> <span class="o">-</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###vec3.norm</span>
<span class="cm">    Normalize a vector.</span>
<span class="cm">    $$B=\frac{A}{|A|}$$</span>

<span class="cm">      vec3.norm(A, B);</span>
<span class="cm">      var B = vec3.norm(A, {});</span>
<span class="cm">    $$\frac{A}{|A|} = 1$$</span>

<span class="cm">      vec3.norm(A,A);</span>
<span class="cm">  */</span>
  <span class="nx">norm</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">vec</span><span class="p">,</span> <span class="nx">dest</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
        <span class="nx">y</span> <span class="o">=</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span>
        <span class="nx">z</span> <span class="o">=</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">z</span><span class="p">,</span>
        <span class="nx">imag</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span> <span class="o">*</span> <span class="nx">y</span> <span class="o">+</span> <span class="nx">z</span> <span class="o">*</span> <span class="nx">z</span><span class="p">);</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">imag</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">y</span> <span class="o">*</span> <span class="nx">imag</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="nx">z</span> <span class="o">*</span> <span class="nx">imag</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###vec3.cross</span>
<span class="cm">    Cross product. If you use it on a vec4 you&#39;ll get nonsense.</span>
<span class="cm">    $$ \mathbf{C} = \mathbf{A}\times\mathbf{B}$$</span>

<span class="cm">      vec3.cross(A, B, C);</span>
<span class="cm">      var C = vec3.cross(A, B, {});</span>
<span class="cm">  */</span>
  <span class="nx">cross</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">vec1</span><span class="p">,</span> <span class="nx">vec2</span><span class="p">,</span> <span class="nx">dest</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">x1</span> <span class="o">=</span> <span class="nx">vec1</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">x2</span> <span class="o">=</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
        <span class="nx">y1</span> <span class="o">=</span> <span class="nx">vec1</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">y2</span> <span class="o">=</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span>
        <span class="nx">z1</span> <span class="o">=</span> <span class="nx">vec1</span><span class="p">.</span><span class="nx">z</span><span class="p">,</span> <span class="nx">z2</span> <span class="o">=</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">y1</span> <span class="o">*</span> <span class="nx">z2</span> <span class="o">-</span> <span class="nx">z1</span> <span class="o">*</span> <span class="nx">y2</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">z1</span> <span class="o">*</span> <span class="nx">x2</span> <span class="o">-</span> <span class="nx">x1</span> <span class="o">*</span> <span class="nx">z2</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="nx">x1</span> <span class="o">*</span> <span class="nx">y2</span> <span class="o">-</span> <span class="nx">y1</span> <span class="o">*</span> <span class="nx">x2</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###vec3.dot</span>
<span class="cm">    Dot product between two vectors.</span>
<span class="cm">    $$c = \mathbf{A}\cdot\mathbf{B}$$</span>

<span class="cm">      var c = vec3.dot(A,B);</span>
<span class="cm">  */</span>
  <span class="nx">dot</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">vec1</span><span class="p">,</span> <span class="nx">vec2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">vec1</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span>
           <span class="nx">vec1</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span>
           <span class="nx">vec1</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###vec3.scale</span>
<span class="cm">    Scale a vector by a constant.</span>
<span class="cm">    $$\mathbf{B} = a\mathbf{A}$$</span>

<span class="cm">      var a = 5,</span>
<span class="cm">          A = vec3.create(1,2,3);</span>
<span class="cm">      B = vec3.scale(a,A, {});</span>
<span class="cm">      vec3.scale{2, A, A};</span>
<span class="cm">  */</span>
  <span class="nx">scale</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">scale</span><span class="p">,</span> <span class="nx">vec</span><span class="p">,</span> <span class="nx">dest</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">scale</span> <span class="o">*</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">scale</span> <span class="o">*</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="nx">scale</span> <span class="o">*</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm">##mat3</span>
<span class="cm">  Functions for 3x3 element matrices of format:</span>

<span class="cm">    A = {aa: aa, ab: ab, ac: ac,</span>
<span class="cm">         ba: ba, bb: bb, bc: bc,</span>
<span class="cm">         ca: ca, cb: cb, cc: cc}</span>
<span class="cm">  First letter is column, second is row.</span>
<span class="cm">  $$\begin{pmatrix}aa&amp;ab&amp;ac\\\\</span>
<span class="cm">                   ba&amp;bb&amp;bc\\\\</span>
<span class="cm">                   ca&amp;cb&amp;cc</span>
<span class="cm">  \end{pmatrix}$$</span>
<span class="cm"> </span>
<span class="cm">  Any vec3 is assumed to be column vectors unless mentioned.</span>
<span class="cm">  Default multiplication is with the matrix on the left.</span>
<span class="cm">*/</span>
<span class="kd">var</span> <span class="nx">mat3</span> <span class="o">=</span> <span class="p">{</span>
  <span class="cm">/*</span>
<span class="cm">  ###mat3.create</span>
<span class="cm">    Usage:</span>

<span class="cm">      var A = vec3.create(1,2,3,4,5,6,7,8,9);</span>
<span class="cm">  */</span>
  <span class="nx">create</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">aa</span><span class="p">,</span> <span class="nx">ab</span><span class="p">,</span> <span class="nx">ac</span><span class="p">,</span> <span class="nx">ba</span><span class="p">,</span> <span class="nx">bb</span><span class="p">,</span> <span class="nx">bc</span><span class="p">,</span> <span class="nx">ca</span><span class="p">,</span> <span class="nx">cb</span><span class="p">,</span> <span class="nx">cc</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">aa</span><span class="o">:</span> <span class="nx">aa</span><span class="p">,</span> <span class="nx">ab</span><span class="o">:</span> <span class="nx">ab</span><span class="p">,</span> <span class="nx">ac</span><span class="o">:</span> <span class="nx">ac</span><span class="p">,</span>
      <span class="nx">ba</span><span class="o">:</span> <span class="nx">ba</span><span class="p">,</span> <span class="nx">bb</span><span class="o">:</span> <span class="nx">bb</span><span class="p">,</span> <span class="nx">bc</span><span class="o">:</span> <span class="nx">bc</span><span class="p">,</span>
      <span class="nx">ca</span><span class="o">:</span> <span class="nx">ca</span><span class="p">,</span> <span class="nx">cb</span><span class="o">:</span> <span class="nx">cb</span><span class="p">,</span> <span class="nx">cc</span><span class="o">:</span> <span class="nx">cc</span>
    <span class="p">};</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###mat3.set</span>
<span class="cm">    Usage:</span>

<span class="cm">      var A = vec3.create(1,2,3,4,5,6,7,8,9, {});</span>
<span class="cm">    Alternate:</span>

<span class="cm">      vec3.create(1,2,3,4,5,6,7,8,9, A);</span>
<span class="cm">  */</span>
  <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">aa</span><span class="p">,</span> <span class="nx">ab</span><span class="p">,</span> <span class="nx">ac</span><span class="p">,</span> <span class="nx">ba</span><span class="p">,</span> <span class="nx">bb</span><span class="p">,</span> <span class="nx">bc</span><span class="p">,</span> <span class="nx">ca</span><span class="p">,</span> <span class="nx">cb</span><span class="p">,</span> <span class="nx">cc</span><span class="p">,</span> <span class="nx">dest</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">dest</span><span class="p">.</span><span class="nx">aa</span> <span class="o">=</span> <span class="nx">aa</span><span class="p">;</span>
      <span class="nx">dest</span><span class="p">.</span><span class="nx">ab</span> <span class="o">=</span> <span class="nx">ab</span><span class="p">;</span>
      <span class="nx">dest</span><span class="p">.</span><span class="nx">ac</span> <span class="o">=</span> <span class="nx">ac</span><span class="p">;</span>

      <span class="nx">dest</span><span class="p">.</span><span class="nx">ba</span> <span class="o">=</span> <span class="nx">ba</span><span class="p">;</span>
      <span class="nx">dest</span><span class="p">.</span><span class="nx">bb</span> <span class="o">=</span> <span class="nx">bb</span><span class="p">;</span>
      <span class="nx">dest</span><span class="p">.</span><span class="nx">bc</span> <span class="o">=</span> <span class="nx">bc</span><span class="p">;</span>

      <span class="nx">dest</span><span class="p">.</span><span class="nx">ca</span> <span class="o">=</span> <span class="nx">ca</span><span class="p">;</span>
      <span class="nx">dest</span><span class="p">.</span><span class="nx">cb</span> <span class="o">=</span> <span class="nx">cb</span><span class="p">;</span>
      <span class="nx">dest</span><span class="p">.</span><span class="nx">cc</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###mat3.mulVec3</span>
<span class="cm">  Multiply a vec3 by a mat3 on the left putting the result into a vec3.</span>
<span class="cm">  $$\mathbf{U} = A\mathbf{V}$$</span>

<span class="cm">      U = mat3.mulVec3(A, V, {});</span>
<span class="cm">  Or:</span>

<span class="cm">      mat3.mulVec3(A, V, U);</span>
<span class="cm">  Or with an implicit 1 if dest is the same as the input and a vec4:</span>
<span class="cm">  $$\begin{pmatrix}1&amp; 0&amp; 0&amp; 0\\\\</span>
<span class="cm">                 0&amp;aa&amp;ab&amp;ac\\\\</span>
<span class="cm">                 0&amp;ba&amp;bb&amp;bc\\\\</span>
<span class="cm">                 0&amp;ca&amp;cb&amp;cc\end{pmatrix}</span>
<span class="cm">  \begin{pmatrix}t\\\\x\\\\y\\\\z\end{pmatrix}$$</span>

<span class="cm">      mat3.mulVec3(mat3, U, U);</span>
<span class="cm">  */</span>
  <span class="nx">mulVec3</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">m</span><span class="p">,</span> <span class="nx">vec3</span><span class="p">,</span> <span class="nx">dest</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">vec3</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
        <span class="nx">y</span> <span class="o">=</span> <span class="nx">vec3</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span>
        <span class="nx">z</span> <span class="o">=</span> <span class="nx">vec3</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">aa</span> <span class="o">*</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">m</span><span class="p">.</span><span class="nx">ab</span> <span class="o">*</span> <span class="nx">y</span> <span class="o">+</span> <span class="nx">m</span><span class="p">.</span><span class="nx">ac</span> <span class="o">*</span> <span class="nx">z</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">ba</span> <span class="o">*</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">m</span><span class="p">.</span><span class="nx">bb</span> <span class="o">*</span> <span class="nx">y</span> <span class="o">+</span> <span class="nx">m</span><span class="p">.</span><span class="nx">bc</span> <span class="o">*</span> <span class="nx">z</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">ca</span> <span class="o">*</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">m</span><span class="p">.</span><span class="nx">cb</span> <span class="o">*</span> <span class="nx">y</span> <span class="o">+</span> <span class="nx">m</span><span class="p">.</span><span class="nx">cc</span> <span class="o">*</span> <span class="nx">z</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###mat3.mul</span>
<span class="cm">  Multiply two 3x3 matrices.</span>
<span class="cm">  Empirical testing showed caching was detrimental on recent browsers.</span>
<span class="cm">    $$\begin{pmatrix}aa&amp;ab&amp;ac\\\\</span>
<span class="cm">                     ba&amp;bb&amp;bc\\\\</span>
<span class="cm">                     ca&amp;cb&amp;cc\end{pmatrix}</span>
<span class="cm">      \begin{pmatrix}aa&amp;ab&amp;ac\\\\</span>
<span class="cm">                     ba&amp;bb&amp;bc\\\\</span>
<span class="cm">                     ca&amp;cb&amp;cc\end{pmatrix}$$</span>
<span class="cm">  Usage:</span>

<span class="cm">      C = mat3.mul(A,B,{});</span>
<span class="cm">      mat3.mul(A,B,C);</span>
<span class="cm">  */</span>
  <span class="nx">mul</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">m1</span><span class="p">,</span> <span class="nx">m2</span><span class="p">,</span> <span class="nx">dest</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">aa</span> <span class="o">=</span> <span class="nx">m1</span><span class="p">.</span><span class="nx">aa</span> <span class="o">*</span> <span class="nx">m2</span><span class="p">.</span><span class="nx">aa</span> <span class="o">+</span> <span class="nx">m1</span><span class="p">.</span><span class="nx">ab</span> <span class="o">*</span> <span class="nx">m2</span><span class="p">.</span><span class="nx">ba</span> <span class="o">+</span> <span class="nx">m1</span><span class="p">.</span><span class="nx">ac</span> <span class="o">*</span> <span class="nx">m2</span><span class="p">.</span><span class="nx">ca</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">ab</span> <span class="o">=</span> <span class="nx">m1</span><span class="p">.</span><span class="nx">aa</span> <span class="o">*</span> <span class="nx">m2</span><span class="p">.</span><span class="nx">ab</span> <span class="o">+</span> <span class="nx">m1</span><span class="p">.</span><span class="nx">ab</span> <span class="o">*</span> <span class="nx">m2</span><span class="p">.</span><span class="nx">bb</span> <span class="o">+</span> <span class="nx">m1</span><span class="p">.</span><span class="nx">ac</span> <span class="o">*</span> <span class="nx">m2</span><span class="p">.</span><span class="nx">cb</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">ac</span> <span class="o">=</span> <span class="nx">m1</span><span class="p">.</span><span class="nx">aa</span> <span class="o">*</span> <span class="nx">m2</span><span class="p">.</span><span class="nx">ac</span> <span class="o">+</span> <span class="nx">m1</span><span class="p">.</span><span class="nx">ab</span> <span class="o">*</span> <span class="nx">m2</span><span class="p">.</span><span class="nx">bc</span> <span class="o">+</span> <span class="nx">m1</span><span class="p">.</span><span class="nx">ac</span> <span class="o">*</span> <span class="nx">m2</span><span class="p">.</span><span class="nx">cc</span><span class="p">;</span>

    <span class="nx">dest</span><span class="p">.</span><span class="nx">ba</span> <span class="o">=</span> <span class="nx">m1</span><span class="p">.</span><span class="nx">ba</span> <span class="o">*</span> <span class="nx">m2</span><span class="p">.</span><span class="nx">aa</span> <span class="o">+</span> <span class="nx">m1</span><span class="p">.</span><span class="nx">bb</span> <span class="o">*</span> <span class="nx">m2</span><span class="p">.</span><span class="nx">ba</span> <span class="o">+</span> <span class="nx">m1</span><span class="p">.</span><span class="nx">bc</span> <span class="o">*</span> <span class="nx">m2</span><span class="p">.</span><span class="nx">ca</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">bb</span> <span class="o">=</span> <span class="nx">m1</span><span class="p">.</span><span class="nx">ba</span> <span class="o">*</span> <span class="nx">m2</span><span class="p">.</span><span class="nx">ab</span> <span class="o">+</span> <span class="nx">m1</span><span class="p">.</span><span class="nx">bb</span> <span class="o">*</span> <span class="nx">m2</span><span class="p">.</span><span class="nx">bb</span> <span class="o">+</span> <span class="nx">m1</span><span class="p">.</span><span class="nx">bc</span> <span class="o">*</span> <span class="nx">m2</span><span class="p">.</span><span class="nx">cb</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">bc</span> <span class="o">=</span> <span class="nx">m1</span><span class="p">.</span><span class="nx">ba</span> <span class="o">*</span> <span class="nx">m2</span><span class="p">.</span><span class="nx">ac</span> <span class="o">+</span> <span class="nx">m1</span><span class="p">.</span><span class="nx">bb</span> <span class="o">*</span> <span class="nx">m2</span><span class="p">.</span><span class="nx">bc</span> <span class="o">+</span> <span class="nx">m1</span><span class="p">.</span><span class="nx">bc</span> <span class="o">*</span> <span class="nx">m2</span><span class="p">.</span><span class="nx">cc</span><span class="p">;</span>

    <span class="nx">dest</span><span class="p">.</span><span class="nx">ca</span> <span class="o">=</span> <span class="nx">m1</span><span class="p">.</span><span class="nx">ca</span> <span class="o">*</span> <span class="nx">m2</span><span class="p">.</span><span class="nx">aa</span> <span class="o">+</span> <span class="nx">m1</span><span class="p">.</span><span class="nx">cb</span> <span class="o">*</span> <span class="nx">m2</span><span class="p">.</span><span class="nx">ba</span> <span class="o">+</span> <span class="nx">m1</span><span class="p">.</span><span class="nx">cc</span> <span class="o">*</span> <span class="nx">m2</span><span class="p">.</span><span class="nx">ca</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">cb</span> <span class="o">=</span> <span class="nx">m1</span><span class="p">.</span><span class="nx">ca</span> <span class="o">*</span> <span class="nx">m2</span><span class="p">.</span><span class="nx">ab</span> <span class="o">+</span> <span class="nx">m1</span><span class="p">.</span><span class="nx">cb</span> <span class="o">*</span> <span class="nx">m2</span><span class="p">.</span><span class="nx">bb</span> <span class="o">+</span> <span class="nx">m1</span><span class="p">.</span><span class="nx">cc</span> <span class="o">*</span> <span class="nx">m2</span><span class="p">.</span><span class="nx">cb</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">cc</span> <span class="o">=</span> <span class="nx">m1</span><span class="p">.</span><span class="nx">ca</span> <span class="o">*</span> <span class="nx">m2</span><span class="p">.</span><span class="nx">ac</span> <span class="o">+</span> <span class="nx">m1</span><span class="p">.</span><span class="nx">cb</span> <span class="o">*</span> <span class="nx">m2</span><span class="p">.</span><span class="nx">bc</span> <span class="o">+</span> <span class="nx">m1</span><span class="p">.</span><span class="nx">cc</span> <span class="o">*</span> <span class="nx">m2</span><span class="p">.</span><span class="nx">cc</span><span class="p">;</span>

    <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###mat3.vecToRows</span>
<span class="cm">  Make a matrix with rows consisting of vec3s (or the x,y,z components of</span>
<span class="cm">  vec4s.</span>
<span class="cm">  Useful for producing a transformation from a set of basis vectors.</span>
<span class="cm">  Usage:</span>

<span class="cm">      T = mat3.vecToRows(X,Y,Z,{});</span>
<span class="cm">      mat3.vecToRows(X, Y, Z, T);</span>
<span class="cm">  */</span>
  <span class="nx">vecToRows</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">vec1</span><span class="p">,</span> <span class="nx">vec2</span><span class="p">,</span> <span class="nx">vec3</span><span class="p">,</span> <span class="nx">dest</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">aa</span> <span class="o">=</span> <span class="nx">vec1</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">ab</span> <span class="o">=</span> <span class="nx">vec1</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">ac</span> <span class="o">=</span> <span class="nx">vec1</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>

    <span class="nx">dest</span><span class="p">.</span><span class="nx">ba</span> <span class="o">=</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">bb</span> <span class="o">=</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">bc</span> <span class="o">=</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>

    <span class="nx">dest</span><span class="p">.</span><span class="nx">ca</span> <span class="o">=</span> <span class="nx">vec3</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">cb</span> <span class="o">=</span> <span class="nx">vec3</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">cc</span> <span class="o">=</span> <span class="nx">vec3</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>


<span class="kd">var</span> <span class="nx">vec4</span> <span class="o">=</span> <span class="p">{</span>
  <span class="cm">/*</span>
<span class="cm">  ###vec4.create</span>
<span class="cm">    Usage:</span>

<span class="cm">      var X = vec3.create(1,2,3,4);</span>
<span class="cm">    Somewhat redundant as it&#39;s equivalent to:</span>

<span class="cm">      var X = vec3.setScalar(1,2,3,4,{});</span>
<span class="cm">  */</span>
  <span class="nx">create</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">,</span> <span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span><span class="nx">x</span><span class="o">:</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="o">:</span> <span class="nx">z</span><span class="p">,</span> <span class="nx">t</span><span class="o">:</span> <span class="nx">t</span><span class="p">};</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###vec4.setVec</span>
<span class="cm">    Usage:</span>

<span class="cm">      B = vec3.setVec(A,B);</span>
<span class="cm">      vec3.setVec(A,B);</span>
<span class="cm">      var B = vec3.setVec(A,{});</span>
<span class="cm">    Set one vector from another. Or create one using an object literal</span>
<span class="cm">    as the destination.</span>
<span class="cm">  */</span>
  <span class="nx">setVec</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">vec</span><span class="p">,</span> <span class="nx">dest</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">t</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###vec4.set</span>
<span class="cm">    Set vector from components.</span>

<span class="cm">      vec4.set(1,2,3,4, B);</span>
<span class="cm">      var B = vec3.set(1,2,3,4, {});</span>
<span class="cm">  */</span>
  <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">,</span> <span class="nx">t</span><span class="p">,</span> <span class="nx">dest</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="nx">z</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="nx">t</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###vec4.add</span>
<span class="cm">    Add two vectors.</span>
<span class="cm">    $$\mathbf{C} = \mathbf{A} + \mathbf{B}$$</span>

<span class="cm">      vec4.add(A, B, C);</span>
<span class="cm">      var C = vec4.add(A, B, {});</span>
<span class="cm">  */</span>
  <span class="nx">add</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">vec1</span><span class="p">,</span> <span class="nx">vec2</span><span class="p">,</span> <span class="nx">dest</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">vec1</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">vec1</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="nx">vec1</span><span class="p">.</span><span class="nx">z</span> <span class="o">+</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="nx">vec1</span><span class="p">.</span><span class="nx">t</span> <span class="o">+</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">t</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###vec4.subtract</span>
<span class="cm">    Subtract two vectors.</span>
<span class="cm">    $$\mathbf{C} = \mathbf{A} - \mathbf{B}$$</span>

<span class="cm">      vec4.subtract(A, B, C);</span>
<span class="cm">      var C = vec4.subtract(A, B, {});</span>
<span class="cm">  */</span>
  <span class="nx">subtract</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">vec1</span><span class="p">,</span> <span class="nx">vec2</span><span class="p">,</span> <span class="nx">dest</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">vec1</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">vec1</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="nx">vec1</span><span class="p">.</span><span class="nx">z</span> <span class="o">-</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###vec4.norm</span>
<span class="cm">    Normalize a vector. With 4D Euclidean norm.</span>
<span class="cm">    $$B=\frac{A}{|A|}$$</span>

<span class="cm">      vec4.norm(A, B);</span>
<span class="cm">      var B = vec4.norm(A, {});</span>
<span class="cm">    $$\frac{A}{|A|} = 1$$</span>

<span class="cm">      vec4.norm(A,A);</span>

<span class="cm">    Returns a vector of 0s if the magnitude is 0.</span>
<span class="cm">  */</span>
  <span class="nx">norm</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">vec</span><span class="p">,</span> <span class="nx">dest</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">mag</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span> <span class="o">*</span> <span class="nx">y</span> <span class="o">+</span> <span class="nx">z</span> <span class="o">*</span> <span class="nx">z</span> <span class="o">+</span> <span class="nx">t</span> <span class="o">*</span> <span class="nx">t</span><span class="p">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">mag</span> <span class="o">=</span> <span class="nx">mag</span> <span class="o">?</span> <span class="mi">1</span><span class="o">/</span><span class="nx">mag</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">mag</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">mag</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">mag</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">t</span> <span class="o">*</span> <span class="nx">mag</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###vec4.spaceNorm</span>
<span class="cm">    Normalize a 4D vector. With 3D euclidean norm.</span>
<span class="cm">    $$A = \begin{pmatrix}t\\\\x\\\\y\\\\z\end{pmatrix}$$</span>
<span class="cm">    $$a=\sqrt{x^2 + y^2 + z^2}$$</span>
<span class="cm">    $$B=\frac{A}{a}$$</span>

<span class="cm">      vec4.norm(A, B);</span>
<span class="cm">      var B = vec4.norm(A, {});</span>
<span class="cm">    $$\frac{A}{a} = 1$$</span>

<span class="cm">      vec4.norm(A,A);</span>

<span class="cm">    Returns a vector of 0s if the magnitude is 0.</span>
<span class="cm">  */</span>
  <span class="nx">spaceNorm</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">vec</span><span class="p">,</span> <span class="nx">dest</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">mag</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span> <span class="o">*</span> <span class="nx">y</span> <span class="o">+</span> <span class="nx">z</span> <span class="o">*</span> <span class="nx">z</span><span class="p">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <p>Return 0 vector if mag is null.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">mag</span> <span class="o">=</span> <span class="nx">mag</span> <span class="o">?</span> <span class="mi">1</span><span class="o">/</span><span class="nx">mag</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">mag</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">mag</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">mag</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">t</span> <span class="o">*</span> <span class="nx">mag</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###vec4.stNorm</span>
<span class="cm">    Normalize a vector. With 4D Minkowski norm.</span>
<span class="cm">    $$B=\frac{A}{|A|}$$</span>

<span class="cm">      vec4.norm(A, B);</span>
<span class="cm">      var B = vec4.norm(A, {});</span>
<span class="cm">    $$\frac{A}{|A|} = 1$$</span>

<span class="cm">      vec4.norm(A,A);</span>

<span class="cm">    Returns a null vector with t component 1 if the magnitude is 0.</span>
<span class="cm">  */</span>
  <span class="nx">stNorm</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">vec</span><span class="p">,</span> <span class="nx">dest</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">mag</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span> <span class="o">*</span> <span class="nx">y</span> <span class="o">+</span> <span class="nx">z</span> <span class="o">*</span> <span class="nx">z</span> <span class="o">-</span> <span class="nx">t</span> <span class="o">*</span> <span class="nx">t</span><span class="p">);</span>
    <span class="nx">mag</span> <span class="o">=</span> <span class="nx">mag</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">/</span> <span class="nx">mag</span> <span class="o">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">t</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <p>Return 0 vector if mag is null.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">dest</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">mag</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">mag</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">mag</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">t</span> <span class="o">*</span> <span class="nx">mag</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###vec4.dot</span>
<span class="cm">    4D Euclidean inner product between two vectors.</span>
<span class="cm">    $$c = \mathbf{A}\cdot\mathbf{B} = </span>
<span class="cm">    A_tB_t + A_xB_x + A_yB_y + A_zB_z$$</span>

<span class="cm">      var c = vec4.dot(A,B);</span>

<span class="cm">  */</span>
  <span class="nx">dot</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">vec1</span><span class="p">,</span> <span class="nx">vec2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">vec1</span><span class="p">.</span><span class="nx">t</span> <span class="o">*</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">t</span> <span class="o">+</span>
           <span class="nx">vec1</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span>
           <span class="nx">vec1</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span>
           <span class="nx">vec1</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###vec4.spaceDot</span>
<span class="cm">  Spatial magnitude. Good for distances.</span>
<span class="cm">  $$\begin{pmatrix}A_t&amp;A_x&amp;A_y&amp;A_z\end{pmatrix}</span>
<span class="cm">  \begin{pmatrix}0&amp;0&amp;0&amp;0\\\\</span>
<span class="cm">                 0&amp;1&amp;0&amp;0\\\\</span>
<span class="cm">                 0&amp;0&amp;1&amp;0\\\\</span>
<span class="cm">                 0&amp;0&amp;0&amp;1\end{pmatrix}</span>
<span class="cm">  \begin{pmatrix}B_t\\\\B_x\\\\B_y\\\\B_z\end{pmatrix}$$</span>
<span class="cm">  Usage:</span>

<span class="cm">      r = spaceDot(A,B);</span>
<span class="cm">  */</span>
  <span class="nx">spaceDot</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">vec1</span><span class="p">,</span> <span class="nx">vec2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">vec1</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span>
           <span class="nx">vec1</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span>
           <span class="nx">vec1</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###vec4.stDot</span>
<span class="cm">    1+3D Minkowski inner product between two vectors.</span>
<span class="cm">    $$c = \mathbf{A}\cdot\mathbf{B} = </span>
<span class="cm">    -A_tB_t + A_xB_x + A_yB_y + A_zB_z$$</span>

<span class="cm">      var c = vec4.stDot(A,B);</span>

<span class="cm">  */</span>
  <span class="nx">stDot</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">vec1</span><span class="p">,</span> <span class="nx">vec2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">-</span><span class="nx">vec1</span><span class="p">.</span><span class="nx">t</span> <span class="o">*</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">t</span> <span class="o">+</span> 
            <span class="nx">vec1</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span>
            <span class="nx">vec1</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span>
            <span class="nx">vec1</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">vec2</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###vec4.scale</span>
<span class="cm">    Scale a vector by a constant.</span>
<span class="cm">    $$\mathbf{B} = a\mathbf{A}$$</span>

<span class="cm">      var a = 5,</span>
<span class="cm">          A = vec4.create(1,2,3);</span>
<span class="cm">      B = vec4.scale(a,A, {});</span>
<span class="cm">      vec4.scale{2, A, A};</span>
<span class="cm">  */</span>
  <span class="nx">scale</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">vec</span><span class="p">,</span> <span class="nx">scale</span><span class="p">,</span> <span class="nx">dest</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">scale</span> <span class="o">*</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">scale</span> <span class="o">*</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="nx">scale</span> <span class="o">*</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="nx">scale</span> <span class="o">*</span> <span class="nx">vec</span><span class="p">.</span><span class="nx">t</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###vec4.toLat</span>
<span class="cm">  Projuce latex formatted output with optional type.</span>
<span class="cm">  */</span>
  <span class="nx">toLat</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">vec</span><span class="p">,</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">type</span> <span class="o">=</span> <span class="nx">type</span> <span class="o">||</span> <span class="s1">&#39;pmatrix&#39;</span><span class="p">;</span>
    <span class="k">return</span> <span class="s1">&#39;\\[\\begin{&#39;</span><span class="o">+</span><span class="nx">type</span><span class="o">+</span><span class="s1">&#39;}&#39;</span> <span class="o">+</span>
           <span class="nx">vec</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="s1">&#39; \\\\\n&#39;</span> <span class="o">+</span> 
           <span class="nx">vec</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="s1">&#39; \\\\\n&#39;</span> <span class="o">+</span> 
           <span class="nx">vec</span><span class="p">.</span><span class="nx">z</span> <span class="o">+</span> <span class="s1">&#39; \\\\\n&#39;</span> <span class="o">+</span> 
           <span class="nx">vec</span><span class="p">.</span><span class="nx">t</span> <span class="o">+</span> <span class="s1">&#39; \\end{&#39;</span><span class="o">+</span><span class="nx">type</span><span class="o">+</span><span class="s1">&#39;}\\]&#39;</span><span class="p">;</span> 
  <span class="p">}</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">mat4</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">create</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">aa</span><span class="p">,</span> <span class="nx">ab</span><span class="p">,</span> <span class="nx">ac</span><span class="p">,</span> <span class="nx">ad</span><span class="p">,</span>
                   <span class="nx">ba</span><span class="p">,</span> <span class="nx">bb</span><span class="p">,</span> <span class="nx">bc</span><span class="p">,</span> <span class="nx">bd</span><span class="p">,</span>
                   <span class="nx">ca</span><span class="p">,</span> <span class="nx">cb</span><span class="p">,</span> <span class="nx">cc</span><span class="p">,</span> <span class="nx">cd</span><span class="p">,</span>
                   <span class="nx">da</span><span class="p">,</span> <span class="nx">db</span><span class="p">,</span> <span class="nx">dc</span><span class="p">,</span> <span class="nx">dd</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">aa</span><span class="o">:</span> <span class="nx">aa</span><span class="p">,</span> <span class="nx">ab</span><span class="o">:</span> <span class="nx">ab</span><span class="p">,</span> <span class="nx">ac</span><span class="o">:</span> <span class="nx">ac</span><span class="p">,</span> <span class="nx">ad</span><span class="o">:</span> <span class="nx">ad</span><span class="p">,</span>
      <span class="nx">ba</span><span class="o">:</span> <span class="nx">ba</span><span class="p">,</span> <span class="nx">bb</span><span class="o">:</span> <span class="nx">bb</span><span class="p">,</span> <span class="nx">bc</span><span class="o">:</span> <span class="nx">bc</span><span class="p">,</span> <span class="nx">bd</span><span class="o">:</span> <span class="nx">bd</span><span class="p">,</span>
      <span class="nx">ca</span><span class="o">:</span> <span class="nx">ca</span><span class="p">,</span> <span class="nx">cb</span><span class="o">:</span> <span class="nx">cb</span><span class="p">,</span> <span class="nx">cc</span><span class="o">:</span> <span class="nx">cc</span><span class="p">,</span> <span class="nx">cd</span><span class="o">:</span> <span class="nx">cd</span><span class="p">,</span>
      <span class="nx">da</span><span class="o">:</span> <span class="nx">da</span><span class="p">,</span> <span class="nx">db</span><span class="o">:</span> <span class="nx">db</span><span class="p">,</span> <span class="nx">dc</span><span class="o">:</span> <span class="nx">dc</span><span class="p">,</span> <span class="nx">dd</span><span class="o">:</span> <span class="nx">dd</span>
    <span class="p">};</span>
  <span class="p">},</span>
  <span class="nx">mulVec4</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">A</span><span class="p">,</span> <span class="nx">vec4</span><span class="p">,</span> <span class="nx">dest</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">vec4</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
        <span class="nx">y</span> <span class="o">=</span> <span class="nx">vec4</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span>
        <span class="nx">z</span> <span class="o">=</span> <span class="nx">vec4</span><span class="p">.</span><span class="nx">z</span><span class="p">,</span>
        <span class="nx">t</span> <span class="o">=</span> <span class="nx">vec4</span><span class="p">.</span><span class="nx">t</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">aa</span> <span class="o">*</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">ab</span> <span class="o">*</span> <span class="nx">y</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">ac</span> <span class="o">*</span> <span class="nx">z</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">ad</span> <span class="o">*</span> <span class="nx">t</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">ba</span> <span class="o">*</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">bb</span> <span class="o">*</span> <span class="nx">y</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">bc</span> <span class="o">*</span> <span class="nx">z</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">bd</span> <span class="o">*</span> <span class="nx">t</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">ca</span> <span class="o">*</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">cb</span> <span class="o">*</span> <span class="nx">y</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">cc</span> <span class="o">*</span> <span class="nx">z</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">cd</span> <span class="o">*</span> <span class="nx">t</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">da</span> <span class="o">*</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">db</span> <span class="o">*</span> <span class="nx">y</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">dc</span> <span class="o">*</span> <span class="nx">z</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">dd</span> <span class="o">*</span> <span class="nx">t</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">mul</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">A</span><span class="p">,</span> <span class="nx">B</span><span class="p">,</span> <span class="nx">dest</span><span class="p">)</span> <span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <p>If the vector is null, normalise it so t component == 1.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nx">dest</span><span class="p">.</span><span class="nx">aa</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">aa</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">aa</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">ab</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">ba</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">ac</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">ca</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">ad</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">da</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">ab</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">aa</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">ab</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">ab</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">bb</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">ac</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">cb</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">ad</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">db</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">ac</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">aa</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">ac</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">ab</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">bc</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">ac</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">cc</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">ad</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">dc</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">ad</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">aa</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">ad</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">ab</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">bd</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">ac</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">cd</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">ad</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">dd</span><span class="p">;</span>

    <span class="nx">dest</span><span class="p">.</span><span class="nx">ba</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">ba</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">aa</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">bb</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">ba</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">bc</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">ca</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">bd</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">da</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">bb</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">ba</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">ab</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">bb</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">bb</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">bc</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">cb</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">bd</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">db</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">bc</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">ba</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">ac</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">bb</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">bc</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">bc</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">cc</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">bd</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">dc</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">bd</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">ba</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">ad</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">bb</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">bd</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">bc</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">cd</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">bd</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">dd</span><span class="p">;</span>

    <span class="nx">dest</span><span class="p">.</span><span class="nx">ca</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">ca</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">aa</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">cb</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">ba</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">cc</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">ca</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">cd</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">da</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">cb</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">ca</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">ab</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">cb</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">bb</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">cc</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">cb</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">cd</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">db</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">cc</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">ca</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">ac</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">cb</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">bc</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">cc</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">cc</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">cd</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">dc</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">cd</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">ca</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">ad</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">cb</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">bd</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">cc</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">cd</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">cd</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">dd</span><span class="p">;</span>

    <span class="nx">dest</span><span class="p">.</span><span class="nx">da</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">da</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">aa</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">db</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">ba</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">dc</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">ca</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">dd</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">da</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">db</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">da</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">ab</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">db</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">bb</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">dc</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">cb</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">dd</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">db</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">dc</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">da</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">ac</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">db</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">bc</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">dc</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">cc</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">dd</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">dc</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">dd</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">da</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">ad</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">db</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">bd</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">dc</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">cd</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">dd</span> <span class="o">*</span> <span class="nx">B</span><span class="p">.</span><span class="nx">dd</span><span class="p">;</span>

    <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###mat4.textMul</span>
<span class="cm">  Some very simple symbolic manipulation, assuming input is a string and</span>
<span class="cm">  outputting a string.</span>
<span class="cm">  Nobody is quite sure why this happened.</span>
<span class="cm">  */</span>
  <span class="nx">textMul</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">A</span><span class="p">,</span> <span class="nx">B</span><span class="p">,</span> <span class="nx">dest</span><span class="p">,</span> <span class="nx">timesChar</span><span class="p">,</span> <span class="nx">plusChar</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">timesChar</span> <span class="o">||</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
        <span class="nx">p</span> <span class="o">=</span> <span class="nx">plusChar</span> <span class="o">||</span> <span class="s1">&#39;+&#39;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="s1">&#39;abcd&#39;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">zero</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span><span class="nx">j</span><span class="p">,</span><span class="nx">k</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">cur</span><span class="p">,</span><span class="nx">prev</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">)){</span>
      <span class="k">for</span><span class="p">(</span><span class="nx">j</span> <span class="k">in</span> <span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">j</span><span class="p">)){</span>
        <span class="nx">dest</span><span class="p">[</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">+</span><span class="nx">a</span><span class="p">[</span><span class="nx">j</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;(&#39;</span><span class="p">;</span>
        <span class="nx">prev</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">a</span><span class="p">){</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">)){</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <p>Yuck.
Multiply AB as below:</p>
<p>/aa ab ac ad\  /aa ab ac ad\
| ba bb bc bd || ba bb bc bd |
| ca cb cc cd || ca cb cc cd |
 \da db dc dd/  \da db dc dd/</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      <p>Nobody likes you, jslint; it's a string
Also what if I <em>want</em> to coerce comparison to 0?</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>          <span class="nx">b</span> <span class="o">=</span> <span class="nx">A</span><span class="p">[</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">+</span><span class="nx">a</span><span class="p">[</span><span class="nx">k</span><span class="p">]];</span>
          <span class="nx">c</span> <span class="o">=</span> <span class="nx">B</span><span class="p">[</span><span class="nx">a</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span><span class="o">+</span><span class="nx">a</span><span class="p">[</span><span class="nx">j</span><span class="p">]];</span>
          <span class="nx">cur</span> <span class="o">=</span> <span class="p">(</span><span class="nx">b</span> <span class="o">==</span> <span class="nx">zero</span> <span class="o">||</span> <span class="nx">c</span> <span class="o">==</span> <span class="nx">zero</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span>
           <span class="p">(</span><span class="nx">b</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">c</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;1&#39;</span> <span class="o">:</span> <span class="p">((</span><span class="nx">b</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">b</span><span class="p">)</span> <span class="o">+</span><span class="nx">t</span><span class="o">+</span> <span class="p">(</span><span class="nx">c</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">c</span><span class="p">));</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <p>If we have no term, set it to '' else, combine two components w a
timesChar.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>          <span class="nx">dest</span><span class="p">[</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">+</span><span class="nx">a</span><span class="p">[</span><span class="nx">j</span><span class="p">]]</span> <span class="o">+=</span> <span class="p">((</span><span class="nx">prev</span> <span class="o">!==</span> <span class="s1">&#39;&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">cur</span> <span class="o">!==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">?</span> <span class="nx">p</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="o">+</span> <span class="nx">cur</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <p>If it's time for a plusChar, give us a plusChar. Append current
term to current element.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>          <span class="nx">prev</span> <span class="o">=</span> <span class="p">(</span><span class="nx">cur</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">prev</span> <span class="o">:</span> <span class="nx">cur</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <p>If we have a non '' term, make it the reference term for plusChar.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="nx">dest</span><span class="p">[</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">+</span><span class="nx">a</span><span class="p">[</span><span class="nx">j</span><span class="p">]]</span> <span class="o">+=</span> <span class="s1">&#39;)&#39;</span><span class="p">;</span>
        <span class="nx">dest</span><span class="p">[</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">+</span><span class="nx">a</span><span class="p">[</span><span class="nx">j</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">dest</span><span class="p">[</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">+</span><span class="nx">a</span><span class="p">[</span><span class="nx">j</span><span class="p">]]</span> <span class="o">===</span> <span class="s1">&#39;()&#39;</span> <span class="o">?</span> <span class="s1">&#39; 0 &#39;</span><span class="o">:</span> 
        <span class="nx">dest</span><span class="p">[</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">+</span><span class="nx">a</span><span class="p">[</span><span class="nx">j</span><span class="p">]]</span> <span class="o">===</span> <span class="s1">&#39;(1)&#39;</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="nx">dest</span><span class="p">[</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">+</span><span class="nx">a</span><span class="p">[</span><span class="nx">j</span><span class="p">]];</span>
      <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###mat4.toText</span>
<span class="cm">  Take a mat4 with numbers and output one with either fixed precision or fixed</span>
<span class="cm">  place decimal strings.</span>
<span class="cm">  Usage:</span>

<span class="cm">      mat4.toText(a, 4, true); // Outputs 0.xxxx</span>
<span class="cm">      mat4.toText(a, 3, false); // Outputs 3 sig figs.</span>
<span class="cm">  */</span>
  <span class="nx">toText</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">A</span><span class="p">,</span> <span class="nx">prec</span><span class="p">,</span> <span class="nx">fixed</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">dest</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">for</span><span class="p">(</span><span class="nx">el</span> <span class="k">in</span> <span class="nx">A</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">A</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">el</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">dest</span><span class="p">[</span><span class="nx">el</span><span class="p">]</span> <span class="o">=</span> <span class="nx">A</span><span class="p">[</span><span class="nx">el</span><span class="p">]</span> <span class="o">?</span> <span class="p">(</span><span class="nx">fixed</span> <span class="o">?</span> <span class="nx">A</span><span class="p">[</span><span class="nx">el</span><span class="p">].</span><span class="nx">toFixed</span><span class="p">(</span><span class="nx">prec</span><span class="p">)</span> <span class="o">:</span> 
                                    <span class="nx">A</span><span class="p">[</span><span class="nx">el</span><span class="p">].</span><span class="nx">toPrecision</span><span class="p">(</span><span class="nx">prec</span><span class="p">))</span> <span class="o">:</span>
                           <span class="s1">&#39; 0 &#39;</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###mat4.toArr</span>
<span class="cm">  Take {aa,...dd} formatted matrix and return 16 element vector with same</span>
<span class="cm">  elements.</span>
<span class="cm">  */</span>
  <span class="nx">toArr</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">A</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="nx">A</span><span class="p">.</span><span class="nx">aa</span><span class="p">,</span><span class="nx">A</span><span class="p">.</span><span class="nx">ab</span><span class="p">,</span><span class="nx">A</span><span class="p">.</span><span class="nx">ac</span><span class="p">,</span><span class="nx">A</span><span class="p">.</span><span class="nx">ad</span><span class="p">,</span>
            <span class="nx">A</span><span class="p">.</span><span class="nx">ba</span><span class="p">,</span><span class="nx">A</span><span class="p">.</span><span class="nx">bb</span><span class="p">,</span><span class="nx">A</span><span class="p">.</span><span class="nx">bc</span><span class="p">,</span><span class="nx">A</span><span class="p">.</span><span class="nx">bd</span><span class="p">,</span>
            <span class="nx">A</span><span class="p">.</span><span class="nx">ca</span><span class="p">,</span><span class="nx">A</span><span class="p">.</span><span class="nx">cb</span><span class="p">,</span><span class="nx">A</span><span class="p">.</span><span class="nx">cc</span><span class="p">,</span><span class="nx">A</span><span class="p">.</span><span class="nx">cd</span><span class="p">,</span>
            <span class="nx">A</span><span class="p">.</span><span class="nx">da</span><span class="p">,</span><span class="nx">A</span><span class="p">.</span><span class="nx">db</span><span class="p">,</span><span class="nx">A</span><span class="p">.</span><span class="nx">dc</span><span class="p">,</span><span class="nx">A</span><span class="p">.</span><span class="nx">dd</span><span class="p">];</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###mat4.toArr2</span>
<span class="cm">  Take {aa,...dd} formatted matrix and return 4 element vector with elements</span>
<span class="cm">  of 4 element vectors with same elements.</span>
<span class="cm">  */</span>
  <span class="nx">toArr2</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">A</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[[</span><span class="nx">A</span><span class="p">.</span><span class="nx">aa</span><span class="p">,</span><span class="nx">A</span><span class="p">.</span><span class="nx">ab</span><span class="p">,</span><span class="nx">A</span><span class="p">.</span><span class="nx">ac</span><span class="p">,</span><span class="nx">A</span><span class="p">.</span><span class="nx">ad</span><span class="p">],</span>
            <span class="p">[</span><span class="nx">A</span><span class="p">.</span><span class="nx">ba</span><span class="p">,</span><span class="nx">A</span><span class="p">.</span><span class="nx">bb</span><span class="p">,</span><span class="nx">A</span><span class="p">.</span><span class="nx">bc</span><span class="p">,</span><span class="nx">A</span><span class="p">.</span><span class="nx">bd</span><span class="p">],</span>
            <span class="p">[</span><span class="nx">A</span><span class="p">.</span><span class="nx">ca</span><span class="p">,</span><span class="nx">A</span><span class="p">.</span><span class="nx">cb</span><span class="p">,</span><span class="nx">A</span><span class="p">.</span><span class="nx">cc</span><span class="p">,</span><span class="nx">A</span><span class="p">.</span><span class="nx">cd</span><span class="p">],</span>
            <span class="p">[</span><span class="nx">A</span><span class="p">.</span><span class="nx">da</span><span class="p">,</span><span class="nx">A</span><span class="p">.</span><span class="nx">db</span><span class="p">,</span><span class="nx">A</span><span class="p">.</span><span class="nx">dc</span><span class="p">,</span><span class="nx">A</span><span class="p">.</span><span class="nx">dd</span><span class="p">]];</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###mat4.fromArr</span>
<span class="cm">  Same as mat4.toArr in reverse.</span>
<span class="cm">  */</span>
  <span class="nx">fromArr</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ar</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">mat4</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">ar</span><span class="p">[</span> <span class="mi">0</span><span class="p">],</span><span class="nx">ar</span><span class="p">[</span> <span class="mi">1</span><span class="p">],</span><span class="nx">ar</span><span class="p">[</span> <span class="mi">2</span><span class="p">],</span><span class="nx">ar</span><span class="p">[</span> <span class="mi">3</span><span class="p">],</span>
                       <span class="nx">ar</span><span class="p">[</span> <span class="mi">4</span><span class="p">],</span><span class="nx">ar</span><span class="p">[</span> <span class="mi">5</span><span class="p">],</span><span class="nx">ar</span><span class="p">[</span> <span class="mi">6</span><span class="p">],</span><span class="nx">ar</span><span class="p">[</span> <span class="mi">7</span><span class="p">],</span>
                       <span class="nx">ar</span><span class="p">[</span> <span class="mi">8</span><span class="p">],</span><span class="nx">ar</span><span class="p">[</span> <span class="mi">9</span><span class="p">],</span><span class="nx">ar</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span><span class="nx">ar</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span>
                       <span class="nx">ar</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span><span class="nx">ar</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span><span class="nx">ar</span><span class="p">[</span><span class="mi">14</span><span class="p">],</span><span class="nx">ar</span><span class="p">[</span><span class="mi">15</span><span class="p">]);</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###mat4.fromArr2</span>
<span class="cm">  Same as mat4.toArr2 in reverse.</span>
<span class="cm">  */</span>
  <span class="nx">fromArr2</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ar</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">mat4</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">ar</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="nx">ar</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="nx">ar</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="nx">ar</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span>
                       <span class="nx">ar</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="nx">ar</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="nx">ar</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="nx">ar</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span>
                       <span class="nx">ar</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="nx">ar</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="nx">ar</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="nx">ar</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span>
                       <span class="nx">ar</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="nx">ar</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="nx">ar</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="nx">ar</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">3</span><span class="p">]);</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###mat4.toLat</span>
<span class="cm">  Take matrix and return latex formatted string with optional type.</span>
<span class="cm">  Type is anything that fits foo in \begin{foo} and accepts row/column input.</span>
<span class="cm">  ie. pmatrix bmatrix etc.</span>
<span class="cm">  */</span>
  <span class="nx">toLat</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">A</span><span class="p">,</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">type</span> <span class="o">=</span> <span class="nx">type</span> <span class="o">||</span> <span class="s1">&#39;pmatrix&#39;</span><span class="p">;</span>
    <span class="k">return</span> <span class="s1">&#39;\\[\\begin{&#39;</span><span class="o">+</span><span class="nx">type</span><span class="o">+</span><span class="s1">&#39;}&#39;</span> <span class="o">+</span>
           <span class="nx">A</span><span class="p">.</span><span class="nx">aa</span> <span class="o">+</span> <span class="s1">&#39; &amp; &#39;</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">ab</span> <span class="o">+</span> <span class="s1">&#39; &amp; &#39;</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">ac</span> <span class="o">+</span> <span class="s1">&#39; &amp; &#39;</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">ad</span> <span class="o">+</span> <span class="s1">&#39; \\\\\n&#39;</span> <span class="o">+</span> 
           <span class="nx">A</span><span class="p">.</span><span class="nx">ba</span> <span class="o">+</span> <span class="s1">&#39; &amp; &#39;</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">bb</span> <span class="o">+</span> <span class="s1">&#39; &amp; &#39;</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">bc</span> <span class="o">+</span> <span class="s1">&#39; &amp; &#39;</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">bd</span> <span class="o">+</span> <span class="s1">&#39; \\\\\n&#39;</span> <span class="o">+</span> 
           <span class="nx">A</span><span class="p">.</span><span class="nx">ca</span> <span class="o">+</span> <span class="s1">&#39; &amp; &#39;</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">cb</span> <span class="o">+</span> <span class="s1">&#39; &amp; &#39;</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">cc</span> <span class="o">+</span> <span class="s1">&#39; &amp; &#39;</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">cd</span> <span class="o">+</span> <span class="s1">&#39; \\\\\n&#39;</span> <span class="o">+</span> 
           <span class="nx">A</span><span class="p">.</span><span class="nx">da</span> <span class="o">+</span> <span class="s1">&#39; &amp; &#39;</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">db</span> <span class="o">+</span> <span class="s1">&#39; &amp; &#39;</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">dc</span> <span class="o">+</span> <span class="s1">&#39; &amp; &#39;</span> <span class="o">+</span> <span class="nx">A</span><span class="p">.</span><span class="nx">dd</span> <span class="o">+</span> <span class="s1">&#39; \\end{&#39;</span><span class="o">+</span><span class="nx">type</span><span class="o">+</span><span class="s1">&#39;}\\]&#39;</span><span class="p">;</span> 
  <span class="p">}</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm">##mat</span>
<span class="cm">General purpose matrix functions.</span>
<span class="cm">Let&#39;s see if all that retardedness was worth it.</span>
<span class="cm">*/</span>
<span class="nx">mat</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">cre</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">w</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">arr</span> <span class="o">=</span> <span class="nx">arr</span> <span class="o">||</span> <span class="p">[];</span>
    <span class="nx">w</span> <span class="o">=</span> <span class="nx">w</span> <span class="o">||</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">h</span> <span class="o">=</span> <span class="nx">h</span> <span class="o">||</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span> <span class="o">||</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">h</span><span class="o">*</span><span class="nx">w</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">arr</span> <span class="o">&amp;&amp;</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="nx">len</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">arr</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="nx">len</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="kd">var</span> <span class="nx">A</span> <span class="o">=</span> <span class="p">{</span><span class="nx">h</span> <span class="o">:</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">w</span><span class="o">:</span> <span class="nx">w</span><span class="p">,</span> <span class="nx">arr</span><span class="o">:</span> <span class="nx">arr</span><span class="p">,</span> <span class="nx">len</span><span class="o">:</span> <span class="nx">len</span><span class="p">};</span>
      <span class="k">return</span> <span class="nx">A</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">sAr</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">A</span><span class="p">,</span> <span class="nx">arr</span><span class="p">,</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">w</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">i</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">h</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">w</span> <span class="o">=</span> <span class="nx">w</span> <span class="o">||</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">h</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
      <span class="nx">w</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">A</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="nx">h</span><span class="p">;</span>
    <span class="nx">A</span><span class="p">.</span><span class="nx">w</span> <span class="o">=</span> <span class="nx">w</span><span class="p">;</span>
    <span class="nx">A</span><span class="p">.</span><span class="nx">len</span> <span class="o">=</span> <span class="nx">h</span><span class="o">*</span><span class="nx">w</span><span class="p">;</span>
    <span class="nx">A</span><span class="p">.</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">len</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="nx">ii</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">len</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ii</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">iArr</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">A</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">A</span><span class="p">,</span> <span class="nx">dest</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">ii</span><span class="p">,</span>
      <span class="nx">arr</span><span class="p">,</span>
      <span class="nx">Aa</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">arr</span><span class="p">;</span>
    <span class="nx">dest</span> <span class="o">=</span> <span class="nx">dest</span> <span class="o">||</span> <span class="p">{};</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">h</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">w</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">w</span><span class="p">;</span>
    <span class="nx">arr</span> <span class="o">=</span> <span class="nx">dest</span><span class="p">.</span><span class="nx">arr</span> <span class="o">||</span> <span class="p">[];</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">arr</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">;</span>
    <span class="nx">ii</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">len</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">len</span> <span class="o">=</span> <span class="nx">ii</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="nx">ii</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ii</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Aa</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">add</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">A</span><span class="p">,</span> <span class="nx">B</span><span class="p">,</span> <span class="nx">dest</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span><span class="nx">ii</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">len</span><span class="p">;</span>
    <span class="k">if</span><span class="p">((</span><span class="nx">ii</span> <span class="o">===</span> <span class="nx">B</span><span class="p">.</span><span class="nx">len</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">A</span><span class="p">.</span><span class="nx">h</span> <span class="o">===</span> <span class="nx">B</span><span class="p">.</span><span class="nx">h</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">dest</span> <span class="o">=</span> <span class="nx">dest</span> <span class="o">||</span> <span class="p">{};</span>
      <span class="kd">var</span> <span class="nx">Aa</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">arr</span><span class="p">,</span>
          <span class="nx">Ba</span> <span class="o">=</span> <span class="nx">B</span><span class="p">.</span><span class="nx">arr</span><span class="p">,</span>
          <span class="nx">arr</span> <span class="o">=</span> <span class="nx">dest</span><span class="p">.</span><span class="nx">arr</span> <span class="o">||</span> <span class="p">[];</span>
      <span class="nx">dest</span><span class="p">.</span><span class="nx">arr</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">;</span>
      <span class="nx">dest</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">h</span><span class="p">;</span>
      <span class="nx">dest</span><span class="p">.</span><span class="nx">w</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">w</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ii</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Aa</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="nx">Ba</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="s2">&quot;Matrix dimensions mismatched.&quot;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">sub</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">A</span><span class="p">,</span> <span class="nx">B</span><span class="p">,</span> <span class="nx">dest</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span><span class="nx">ii</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">len</span><span class="p">;</span>
    <span class="k">if</span><span class="p">((</span><span class="nx">ii</span> <span class="o">===</span> <span class="nx">B</span><span class="p">.</span><span class="nx">len</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">A</span><span class="p">.</span><span class="nx">h</span> <span class="o">===</span> <span class="nx">B</span><span class="p">.</span><span class="nx">h</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">dest</span> <span class="o">=</span> <span class="nx">dest</span> <span class="o">||</span> <span class="p">{};</span>
      <span class="kd">var</span> <span class="nx">Aa</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">arr</span><span class="p">,</span>
          <span class="nx">Ba</span> <span class="o">=</span> <span class="nx">B</span><span class="p">.</span><span class="nx">arr</span><span class="p">,</span>
          <span class="nx">arr</span> <span class="o">=</span> <span class="nx">dest</span><span class="p">.</span><span class="nx">arr</span> <span class="o">||</span> <span class="p">[];</span>
      <span class="nx">dest</span><span class="p">.</span><span class="nx">arr</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">;</span>
      <span class="nx">dest</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">h</span><span class="p">;</span>
      <span class="nx">dest</span><span class="p">.</span><span class="nx">w</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">w</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ii</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Aa</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">-</span> <span class="nx">Ba</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="s2">&quot;Matrix dimensions mismatched.&quot;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">dot</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">A</span><span class="p">,</span> <span class="nx">B</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span>
        <span class="nx">ii</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">len</span><span class="p">,</span>
        <span class="nx">Aa</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">arr</span><span class="p">,</span>
        <span class="nx">Ba</span> <span class="o">=</span> <span class="nx">B</span><span class="p">.</span><span class="nx">arr</span><span class="p">,</span>
        <span class="nx">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="nx">A</span><span class="p">.</span><span class="nx">w</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">A</span><span class="p">.</span><span class="nx">h</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> 
        <span class="nx">ii</span> <span class="o">===</span> <span class="nx">B</span><span class="p">.</span><span class="nx">len</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ii</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
        <span class="nx">res</span> <span class="o">+=</span> <span class="nx">Aa</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">*</span><span class="nx">Ba</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">res</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="s2">&quot;Not a vector or lengths do not match&quot;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">hDt</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">A</span><span class="p">,</span> <span class="nx">B</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span>
        <span class="nx">ii</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">len</span><span class="p">,</span>
        <span class="nx">Aa</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">arr</span><span class="p">,</span>
        <span class="nx">Ba</span> <span class="o">=</span> <span class="nx">B</span><span class="p">.</span><span class="nx">arr</span><span class="p">,</span>
        <span class="nx">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="nx">A</span><span class="p">.</span><span class="nx">w</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">A</span><span class="p">.</span><span class="nx">h</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> 
        <span class="nx">ii</span> <span class="o">===</span> <span class="nx">B</span><span class="p">.</span><span class="nx">len</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">res</span> <span class="o">-=</span> <span class="nx">Aa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nx">Ba</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ii</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
        <span class="nx">res</span> <span class="o">+=</span> <span class="nx">Aa</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">*</span> <span class="nx">Ba</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">res</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="s2">&quot;Not a vector or lengths do not match&quot;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">sDt</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">A</span><span class="p">,</span> <span class="nx">B</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span>
        <span class="nx">ii</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">len</span><span class="p">,</span>
        <span class="nx">Aa</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">arr</span><span class="p">,</span>
        <span class="nx">Ba</span> <span class="o">=</span> <span class="nx">B</span><span class="p">.</span><span class="nx">arr</span><span class="p">,</span>
        <span class="nx">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="nx">A</span><span class="p">.</span><span class="nx">w</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">A</span><span class="p">.</span><span class="nx">h</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> 
        <span class="nx">ii</span> <span class="o">===</span> <span class="nx">B</span><span class="p">.</span><span class="nx">len</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ii</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
        <span class="nx">res</span> <span class="o">+=</span> <span class="nx">Aa</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">*</span> <span class="nx">Ba</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">res</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="s2">&quot;Not a vector or lengths do not match&quot;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">mag</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">A</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span><span class="nx">ii</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">len</span><span class="p">,</span> <span class="nx">Aa</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">A</span><span class="p">.</span><span class="nx">h</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">A</span><span class="p">.</span><span class="nx">w</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ii</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span> <span class="o">+=</span> <span class="nx">Aa</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">*</span> <span class="nx">Aa</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">res</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="s2">&quot;Not a vector.&quot;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">hMg</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">A</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span><span class="nx">ii</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">len</span><span class="p">,</span> <span class="nx">Aa</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">A</span><span class="p">.</span><span class="nx">h</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">A</span><span class="p">.</span><span class="nx">w</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">res</span> <span class="o">-=</span> <span class="nx">Aa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nx">Aa</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ii</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span> <span class="o">+=</span> <span class="nx">Aa</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">*</span> <span class="nx">Aa</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">res</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="s2">&quot;Not a vector.&quot;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">nrm</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">A</span><span class="p">,</span> <span class="nx">dest</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">dest</span> <span class="o">=</span> <span class="nx">dest</span> <span class="o">||</span> <span class="p">{};</span>
    <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span>
        <span class="nx">ii</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">len</span><span class="p">,</span>
        <span class="nx">Aa</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">arr</span><span class="p">,</span>
        <span class="nx">arr</span> <span class="o">=</span> <span class="nx">dest</span><span class="p">.</span><span class="nx">arr</span> <span class="o">||</span> <span class="p">[],</span>
        <span class="nx">mag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="nx">ii</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">arr</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">h</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">w</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">w</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">A</span><span class="p">.</span><span class="nx">h</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">A</span><span class="p">.</span><span class="nx">w</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ii</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">mag</span> <span class="o">+=</span> <span class="nx">Aa</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">*</span> <span class="nx">Aa</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="nx">mag</span> <span class="o">=</span> <span class="nx">mag</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">/</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">mag</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ii</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Aa</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">*</span> <span class="nx">mag</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="s2">&quot;Not a vector.&quot;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">hNm</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">A</span><span class="p">,</span> <span class="nx">dest</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">dest</span> <span class="o">=</span> <span class="nx">dest</span> <span class="o">||</span> <span class="p">{};</span>
    <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span>
        <span class="nx">ii</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">len</span><span class="p">,</span>
        <span class="nx">Aa</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">arr</span><span class="p">,</span>
        <span class="nx">arr</span> <span class="o">=</span> <span class="nx">dest</span><span class="p">.</span><span class="nx">arr</span> <span class="o">||</span> <span class="p">[],</span>
        <span class="nx">mag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="nx">ii</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">arr</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">h</span><span class="p">;</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">w</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">w</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">A</span><span class="p">.</span><span class="nx">h</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">A</span><span class="p">.</span><span class="nx">w</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">mag</span> <span class="o">-=</span> <span class="nx">Aa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nx">Aa</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ii</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">mag</span> <span class="o">+=</span> <span class="nx">Aa</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">*</span> <span class="nx">Aa</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="nx">mag</span> <span class="o">=</span> <span class="nx">mag</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">/</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">mag</span><span class="p">))</span> <span class="o">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="nx">Aa</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ii</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Aa</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">*</span> <span class="nx">mag</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="s2">&quot;Not a vector.&quot;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">crs</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">A</span><span class="p">,</span> <span class="nx">B</span><span class="p">,</span> <span class="nx">dest</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">A</span><span class="p">.</span><span class="nx">len</span> <span class="o">===</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="nx">B</span><span class="p">.</span><span class="nx">len</span> <span class="o">===</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="nx">A</span><span class="p">.</span><span class="nx">h</span> <span class="o">===</span> <span class="nx">B</span><span class="p">.</span><span class="nx">h</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">dest</span> <span class="o">=</span> <span class="nx">dest</span> <span class="o">||</span> <span class="p">{};</span>
      <span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="nx">dest</span><span class="p">.</span><span class="nx">arr</span> <span class="o">||</span> <span class="p">[],</span>
          <span class="nx">Aa</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">arr</span><span class="p">,</span>
          <span class="nx">Ba</span> <span class="o">=</span> <span class="nx">B</span><span class="p">.</span><span class="nx">arr</span><span class="p">;</span>
      <span class="nx">dest</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">h</span><span class="p">;</span>
      <span class="nx">dest</span><span class="p">.</span><span class="nx">w</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">w</span><span class="p">;</span>
      <span class="nx">dest</span><span class="p">.</span><span class="nx">len</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
      <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
      <span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Aa</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nx">Ba</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="nx">Aa</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="nx">Ba</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
      <span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="nx">Aa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nx">Ba</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="nx">Aa</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="nx">Ba</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="nx">arr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Aa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nx">Ba</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="nx">Aa</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nx">Ba</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="s2">&quot;Not a 3-vector or mismatched dimensions.&quot;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="cm">/*</span>
<span class="cm">  ###mat.tri</span>
<span class="cm">  Psuedovector triple product of three 4-vectors.</span>
<span class="cm">  $$\begin{align}</span>
<span class="cm">  A\wedge B\wedge C =&amp; (A\wedge B)\wedge C\\\\</span>
<span class="cm">  =&amp;\left&lt;AB\right&gt;_2\wedge C\\\\</span>
<span class="cm">  =&amp;\left&lt;(A_te_t + A_xe_x + A_ye_y + A_ze_z)</span>
<span class="cm">     (B_te_t + B_xe_x + B_ye_y + B_ze_z)\right&gt;_2\wedge C\\\\</span>
<span class="cm">  =&amp; (A_tB_xe_te_x + A_tB_ye_te_y + A_tB_ze_te_z + </span>
<span class="cm">      A_xB_te_xe_t + A_xB_ye_xe_y + A_xB_ze_xe_z + </span>
<span class="cm">      A_yB_te_ye_t + A_yB_xe_ye_x + A_yB_ze_ye_z + </span>
<span class="cm">      A_zB_te_ze_t + A_zB_xe_ze_x + A_zB_ye_ze_y)</span>
<span class="cm">  \end{align\*}$$</span>
<span class="cm">  */</span>
  <span class="nx">tri</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">A</span><span class="p">,</span> <span class="nx">B</span><span class="p">,</span> <span class="nx">C</span><span class="p">,</span> <span class="nx">dest</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">dest</span> <span class="o">=</span> <span class="nx">dest</span> <span class="o">||</span> <span class="p">{};</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">A</span><span class="p">.</span><span class="nx">len</span> <span class="o">===</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> 
        <span class="nx">B</span><span class="p">.</span><span class="nx">len</span> <span class="o">===</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span>
        <span class="nx">C</span><span class="p">.</span><span class="nx">len</span> <span class="o">===</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span>
        <span class="nx">A</span><span class="p">.</span><span class="nx">h</span> <span class="o">===</span> <span class="nx">B</span><span class="p">.</span><span class="nx">h</span> <span class="o">&amp;&amp;</span>
        <span class="nx">B</span><span class="p">.</span><span class="nx">h</span> <span class="o">===</span> <span class="nx">C</span><span class="p">.</span><span class="nx">h</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="nx">dest</span><span class="p">.</span><span class="nx">arr</span> <span class="o">||</span> <span class="p">[],</span>
          <span class="nx">Aa</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">arr</span><span class="p">,</span>
          <span class="nx">Ba</span> <span class="o">=</span> <span class="nx">B</span><span class="p">.</span><span class="nx">arr</span><span class="p">,</span>
          <span class="nx">Ca</span> <span class="o">=</span> <span class="nx">C</span><span class="p">.</span><span class="nx">arr</span><span class="p">;</span>
      <span class="nx">dest</span><span class="p">.</span><span class="nx">arr</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">;</span>
      <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
      <span class="nx">dest</span><span class="p">.</span><span class="nx">len</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
      <span class="nx">dest</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">h</span><span class="p">;</span>
      <span class="nx">dest</span><span class="p">.</span><span class="nx">w</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">w</span><span class="p">;</span>
      <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span><span class="mi">1</span> <span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

  <span class="p">},</span>
  <span class="nx">mul</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">A</span><span class="p">,</span> <span class="nx">B</span><span class="p">,</span> <span class="nx">dest</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">kk</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">w</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">kk</span> <span class="o">===</span> <span class="nx">B</span><span class="p">.</span><span class="nx">h</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">t</span><span class="p">,</span>
          <span class="nx">h</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">h</span><span class="p">,</span>
          <span class="nx">w</span> <span class="o">=</span> <span class="nx">B</span><span class="p">.</span><span class="nx">w</span><span class="p">,</span>
          <span class="nx">len</span> <span class="o">=</span> <span class="nx">h</span><span class="o">*</span><span class="nx">w</span><span class="p">,</span>
          <span class="nx">Aa</span> <span class="o">=</span> <span class="nx">A</span><span class="p">.</span><span class="nx">arr</span><span class="p">,</span>
          <span class="nx">Ba</span> <span class="o">=</span> <span class="nx">B</span><span class="p">.</span><span class="nx">arr</span><span class="p">,</span>
          <span class="nx">arr</span><span class="p">;</span>
      <span class="nx">dest</span> <span class="o">=</span> <span class="nx">dest</span> <span class="o">||</span> <span class="p">{};</span>
      <span class="nx">dest</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="nx">h</span><span class="p">;</span>
      <span class="nx">dest</span><span class="p">.</span><span class="nx">w</span> <span class="o">=</span> <span class="nx">w</span><span class="p">;</span>
      <span class="nx">dest</span><span class="p">.</span><span class="nx">len</span> <span class="o">=</span> <span class="nx">len</span><span class="p">;</span>
      <span class="nx">arr</span> <span class="o">=</span> <span class="nx">dest</span><span class="p">.</span><span class="nx">arr</span> <span class="o">||</span> <span class="p">[];</span>
      <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="nx">len</span><span class="p">;</span>
      <span class="nx">dest</span><span class="p">.</span><span class="nx">arr</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">h</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">c</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">*</span> <span class="nx">h</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">w</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">k</span> <span class="o">&lt;</span> <span class="nx">kk</span><span class="p">;</span> <span class="nx">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">t</span> <span class="o">+=</span> <span class="nx">Aa</span><span class="p">[</span><span class="nx">c</span><span class="o">+</span><span class="nx">k</span><span class="p">]</span> <span class="o">*</span> <span class="nx">Ba</span><span class="p">[</span><span class="nx">j</span><span class="o">+</span><span class="nx">h</span><span class="o">*</span><span class="nx">k</span><span class="p">];</span>
          <span class="p">}</span>
        <span class="nx">arr</span><span class="p">[</span><span class="nx">c</span><span class="o">+</span><span class="nx">j</span><span class="p">]</span> <span class="o">=</span> <span class="nx">t</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="s2">&quot;Matrix dimensions do not match.&quot;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="nb">window</span><span class="p">[</span><span class="s1">&#39;vec3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">vec3</span><span class="p">;</span>
<span class="nb">window</span><span class="p">[</span><span class="s1">&#39;mat3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">mat3</span><span class="p">;</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <p>If we didn't generate anything, bung in a 0.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
